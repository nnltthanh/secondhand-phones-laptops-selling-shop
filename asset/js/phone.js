const listLogoBrand = {
    apple:
        "asset/img/header/phone/logo-iphone-220x48.png",
    samsung:
        "asset/img/header/phone/samsungnew-220x48-1.png",
    oppo:
        "asset/img/header/phone/OPPO42-b_5.jpg",
    xiaomi:
        "asset/img/header/phone/logo-xiaomi-220x48-5.png",
};

const phone = [
    {
        id: 1,
        name: "iPhone 14 128 GB",
        price: "35.490.000",
        brand: "apple",
        newPrice: "30.790.000",
        image:
            "asset/img/phone/iphone/iphone-14-pro-max-bac-thumb-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 2,
        name: "iPhone 11 128 GB",
        price: "16.490.000",
        brand: "apple",
        newPrice: "10.790.000",
        image:
            "asset/img/phone/iphone/iphone-11-trang.jpg",
        rating: 3,
        sale: 40,
        remain: 25,
    },
    {
        id: 3,
        name: "iPhone 12 128 GB",
        price: "21.490.000",
        brand: "apple",
        newPrice: "13.790.000",
        image:
            "asset/img/phone/iphone/iphone-12-den.jpg",
        rating: 3,
        sale: 40,
        remain: 25,
    },
    {
        id: 4,
        name: "iPhone 12 256 GB",
        price: "23.490.000",
        brand: "apple",
        newPrice: "14.790.000",
        image:
            "asset/img/phone/iphone/iphone-12-trang.jpg",
        rating: 3,
        sale: 40,
        remain: 25,
    },
    {
        id: 5,
        name: "iPhone 12 64 GB",
        price: "21.990.000",
        brand: "apple",
        newPrice: "15.790.000",
        image:
            "asset/img/phone/iphone/iphone-12-mini.jpeg",
        rating: 3,
        sale: 40,
        remain: 25,
    },
    {
        id: 6,
        name: "iPhone 13 mini 128 GB",
        price: "18.490.000",
        brand: "apple",
        newPrice: "12.790.000",
        image:
            "asset/img/phone/iphone/iphone-13-mini.jpg",
        rating: 3,
        sale: 40,
        remain: 25,
    },
    {
        id: 7,
        name: "iPhone 13 mini",
        price: "21.990.000",
        brand: "apple",
        newPrice: "15.790.000",
        image:
            "asset/img/phone/iphone/iphone-13-mini-red.jpg",
        rating: 3,
        sale: 40,
        remain: 25,
    },
    {
        id: 8,
        name: "iPhone 13 Pro 128 GB",
        price: "31.490.000",
        brand: "apple",
        newPrice: "25.790.000",
        image:
            "asset/img/phone/iphone/iphone-13-pro-max-gold-1-600x600.jpg",
        rating: 5,
        sale: 40,
        remain: 25,
    },
    {
        id: 9,
        name: "Oppo A17",
        price: "4.490.000",
        brand: "oppo",
        newPrice: "2.790.000",
        image:
            "asset/img/phone/oppo/oppo-a17-den-thumb-600x600.jpg",
        rating: 5,
        sale: 40,
        remain: 25,
    },
    {
        id: 10,
        name: "Oppo A57 5G",
        price: "4.490.000",
        brand: "oppo",
        newPrice: "2.790.000",
        image:
            "asset/img/phone/oppo/oppo-a57-xanh-thumb-1-600x600.jpg",
        rating: 5,
        sale: 40,
        remain: 25,
    },
    {
        id: 11,
        name: "Oppo A77s 5G",
        price: "7.490.000",
        brand: "oppo",
        newPrice: "6.790.000",
        image:
            "asset/img/phone/oppo/oppo-a77s-den-thumb-1-2-600x600.jpg",
        rating: 5,
        sale: 40,
        remain: 25,
    },
    {
        id: 12,
        name: "Oppo A96 5G",
        price: "6.990.000",
        brand: "oppo",
        newPrice: "4.790.000",
        image:
            "asset/img/phone/oppo/oppo-a96-den-thumb-1-600x600.jpg",
        rating: 5,
        sale: 40,
        remain: 25,
    },
    {
        id: 13,
        name: "Oppo Find X5 Pro",
        price: "28.490.000",
        brand: "oppo",
        newPrice: "23.700.000",
        image:
            "asset/img/phone/oppo/oppo-find-x5-pro-den-thumb-600x600.jpg",
        rating: 5,
        sale: 40,
        remain: 25,
    },
    {
        id: 14,
        name: "Oppo Reno 6 5G",
        price: "12.490.000",
        brand: "oppo",
        newPrice: "8.790.000",
        image:
            "asset/img/phone/oppo/oppo-reno6-5g-black-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 15,
        name: "Oppo Reno 7 5G",
        price: "9.490.000",
        brand: "oppo",
        newPrice: "6.790.000",
        image:
            "asset/img/phone/oppo/oppo-reno7-z-5g-thumb-2-1-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 16,
        name: "Oppo Reno8 5G",
        price: "18.490.000",
        brand: "oppo",
        newPrice: "12.790.000",
        image:
            "asset/img/phone/oppo/oppo-reno8-pro-thumb-xanh-1-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 17,
        name: "Samsung Galaxy Z Flip4 128 GB",
        price: "23.990.000",
        brand: "samsung",
        newPrice: "14.990.000",
        image:
            "asset/img/phone/samsung/samsung-galaxy-z-flip4-5g-128gb-thumb-tim-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 18,
        name: "Samsung Galaxy S21 FE 5G",
        price: "16.490.000",
        brand: "samsung",
        newPrice: "12.790.000",
        image:
            "asset/img/phone/samsung/Samsung-Galaxy-S21-FE-trang-1-2-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 19,
        name: "Samsung Galaxy Z Folld 3 5G",
        price: "41.490.000",
        brand: "samsung",
        newPrice: "35.790.000",
        image:
            "asset/img/phone/samsung/samsung-galaxy-z-fold-3-silver-1-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 20,
        name: "Samsung Galaxy S22+ 5G",
        price: "25.490.000",
        brand: "samsung",
        newPrice: "18.790.000",
        image:
            "asset/img/phone/samsung/Galaxy-S22-Plus-White-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 21,
        name: "Samsung Galaxy A73 5G",
        price: "12.490.000",
        brand: "samsung",
        newPrice: "8.790.000",
        image:
            "asset/img/phone/samsung/samsung-galaxy-a73-5g-xanh-thumb-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 22,
        name: "Samsung Galaxy A53 5G",
        price: "9.490.000",
        brand: "samsung",
        newPrice: "7.790.000",
        image:
            "asset/img/phone/samsung/samsung-galaxy-m53-nau-thumb-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 23,
        name: "Samsung Galaxy A23 5G",
        price: "4.490.000",
        brand: "samsung",
        newPrice: "3.790.000",
        image:
            "asset/img/phone/samsung/sam-sung-galaxy-a23-5g-xanh-thumb-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 24,
        name: "Samsung Galaxy A13 5G",
        price: "7.490.000",
        brand: "samsung",
        newPrice: "5.790.000",
        image:
            "asset/img/phone/samsung/Samsung-Galaxy-A13-cam-thumb-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 25,
        name: "Xiaomi 12",
        price: "16.490.000",
        brand: "xiaomi",
        newPrice: "11.790.000",
        image:
            "asset/img/phone/xiaomi/Xiaomi-12-xam-thumb-mau-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 26,
        name: "Xiaomi 11T",
        price: "10.490.000",
        brand: "xiaomi",
        newPrice: "8.790.000",
        image:
            "asset/img/phone/xiaomi/Xiaomi-11T-White-1-2-3-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 27,
        name: "Xiaomi 11 Lite 5G NE",
        price: "8.490.000",
        brand: "xiaomi",
        newPrice: "6.790.000",
        image:
            "asset/img/phone/xiaomi/xiaomi-11-lite-5g-ne-black-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 28,
        name: "Xiaomi Redmi 10",
        price: "4.490.000",
        brand: "xiaomi",
        newPrice: "3.790.000",
        image:
            "asset/img/phone/xiaomi/redmi-10-gray-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 29,
        name: "Vivo X80",
        price: "10.490.000",
        brand: "vivo",
        newPrice: "7.790.000",
        image:
            "asset/img/phone/vivo/vivo-x80-xanh-thumb-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 30,
        name: "Vivo Y53s",
        price: "8.490.000",
        brand: "vivo",
        newPrice: "4.790.000",
        image:
            "asset/img/phone/vivo/vivo-y53s-xanh-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 31,
        name: "Vivo Y16",
        price: "5.490.000",
        brand: "vivo",
        newPrice: "2.790.000",
        image:
            "asset/img/phone/vivo/vivo-y16-vang-thumb-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 32,
        name: "Vivo Y25s",
        price: "6.490.000",
        brand: "vivo",
        newPrice: "3.790.000",
        image:
            "asset/img/phone/vivo/vivo-v25-5g-vang-thumb-1-1-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    },
    {
        id: 33,
        name: "Vivo TB25",
        price: "5.490.000",
        brand: "vivo",
        newPrice: "2.790.000",
        image:
            "asset/img/phone/vivo/vivo-t1-5g-thumb-den-600x600.jpg",
        rating: 4,
        sale: 40,
        remain: 25,
    }
];

function copyArrayFrom(des, src) {
    for (let i = 0; i < src.length; ++i) {
        des.push(src[i]);
    }
}

let isSorted = '';

var currentProducts = [];
copyArrayFrom(currentProducts, phone);
console.log(currentProducts);

function showProduct(array) {
    let productList = document.querySelector('.items');
    productList.innerHTML = "";
    let i, j, k;
    for (i = 0; i < array.length; ++i) {
        productList.innerHTML += `
        <div id="${array[i].id}" class="col-6 col-sm-2-4 mb-12">
          <div  class="card p-3 shadow product-item position-relative">
              <a href="" class="img-detail"><img class="card-img-top" class="img-product" src="${array[i].image}"  alt=""></a>
              <div class="card-body p-0 pt-2">
                  <div class="product-item-content">
                      <p class="font-weight-bold text-center product-item-name mb-2">${array[i].name}</p>
                      <span class="product-quantity badge rounded bg-secondary mb-2">${array[i].remain} sản phẩm còn lại</span>
                      <div class="price row g-1 p-6">
                        <p class="product-item-price--old mb-2">
                          Giá gốc:
                          <span class="text-gray"><del>${array[i].price}đ</del></span>
                        </p>
                        <p class="product-item-price mb-2">
                          Giá từ:
                          <span class="text-danger font-weight-bold">${array[i].newPrice}đ</span>
                        </p>
                      </div>
                      <div class="d-flex justify-content-between align-items-center mb-2">
                          <div class="ratings">
                          </div>
                      </div>
                      <div class="d-flex justify-content-between align-items-center mb-2 detail">
                          <a href="" class="btn float-end col-12 ">Xem chi tiết</a>
                      </div>
                      <div class="product-item_sale position-absolute top-0 bg-danger rounded-end px-2 py-1">
                            <span class="text-light font-weight-bold small">Giảm ${array[i].sale}%</span>
                      </div>
                      <div class="d-flex justify-content-center align-items-center p-0 cart">
                          <a href="javascript:void(0)" class="btn bg-transparent border-light float-end col-12" onclick="add(${array[i].id})">
                            <i class="fas fa-shopping-basket text-danger"></i>
                          </a>
                      </div>
                  </div>
              </div>   
          </div>
        </div>
          `;
    }
}



function showRatings() {
    let itemRatings = document.querySelectorAll('.ratings');
    for (let i = 0; i < itemRatings.length; ++i) {
        let productItem = Object.assign({}, phone[i]);
        for (let j = 1; j <= productItem.rating; ++j) {
            itemRatings[i].innerHTML += `<i class="fas fa-star rating-color star-icon"></i>`;
        }
        for (let k = 1; k <= 5 - productItem.rating; ++k) {
            itemRatings[i].innerHTML += `<i class="far fa-star star-icon"></i>`;
        }
    }

}

function filterProductByBrand() {
    let selectBrand = document.querySelector('.select-brand');
    let filteredList = [], emptyList = [];

    selectBrand.onchange = function (event) {
        if (isSorted === 'increase') {

            emptyList = sortedOrder(phone, true);
        }
        else if (isSorted === 'decrease') {
            emptyList = sortedOrder(phone, false);
        }
        else {
            copyArrayFrom(emptyList, phone);
        }
        if (`${event.target.value}` == 1) {
            filteredList = emptyList.filter(function (product) {
                return product.brand == 'apple';
            });
            showProduct(filteredList);
            showRatings();
            currentProducts = [];
            copyArrayFrom(currentProducts, filteredList);
        }
        else if (`${event.target.value}` == 2) {
            filteredList = emptyList.filter(function (product) {
                return product.brand == 'samsung';
            });
            showProduct(filteredList);
            showRatings();
            currentProducts = [];
            copyArrayFrom(currentProducts, filteredList);
        }
        else if (`${event.target.value}` == 3) {
            filteredList = emptyList.filter(function (product) {
                return product.brand == 'oppo';
            });
            showProduct(filteredList);
            showRatings();
            currentProducts = [];
            copyArrayFrom(currentProducts, filteredList);
        }
        else if (`${event.target.value}` == 4) {
            filteredList = emptyList.filter(function (product) {
                return product.brand == 'vivo';
            });
            showProduct(filteredList);
            showRatings();
            currentProducts = [];
            copyArrayFrom(currentProducts, filteredList);
        }
        else if (`${event.target.value}` == 5) {
            filteredList = emptyList.filter(function (product) {
                return product.brand == 'xiaomi';
            });
            showProduct(filteredList);
            showRatings();
            currentProducts = [];
            copyArrayFrom(currentProducts, filteredList);
        }
    };
}

function sortedOrder(srcList, order) {
    let x = order ? 1 : -1;
    return srcList.sort(function (a, b) {
        return x * (a.newPrice.replaceAll('.', '') - b.newPrice.replaceAll('.', ''));
    });
}

function sortProduct() {
    let selectPrice = document.querySelector('.select-price');
    let sortedList = [];
    selectPrice.onchange = function (event) {
        if (`${event.target.value}` == 1) {
            sortedList = sortedOrder(currentProducts, true);
            isSorted = 'increase';
        }
        else if (`${event.target.value}` == 2) {
            sortedList = sortedOrder(currentProducts, false);
            isSorted = 'decrease';
        }
        showProduct(sortedList);
        showRatings();
        currentProducts = [];
        copyArrayFrom(currentProducts, sortedList);
    };
}

sortProduct();
filterProductByBrand();
showProduct(phone);
showRatings();

var desinatedProductDetailLink = document.querySelector(' .detail a');
var imgLink = document.querySelector('.img-detail ');

let currentUser = '';
let userAvatar = document.querySelector('.user-avatar img');
let userButton = document.querySelector('.user-btn');
let userButtonLink = document.querySelector('.user-btn a');
let currentAvatar = '';
let users = JSON.parse(localStorage.getItem('user'));
for (let i = 0; i < users.length; ++i) {
    if (users[i].sdt == localStorage.getItem('currentUser')) {
        currentAvatar = users[i].avatar;
        userAvatar.src = currentAvatar;
        userButtonLink.href = 'javascript:void(0)';
        break;
    }
}
let userList = document.querySelector('.user-list-login');
userButton.onclick = function() {
    if (userList.style.display !== 'none')
        userList.style.display = 'none';
    else {
        userList.style.display = 'block';
    }
}
if (currentUser == '') {
    userList.style.display = 'none';
}

desinatedProductDetailLink.href = 'detail.html';
imgLink.href = 'detail.html';

var chatImg = document.querySelector('.chat-img');
var chatBox = document.querySelector('.chatbox');
var minimizeIcon = document.querySelector('.minimize-icon');
chatImg.onclick = function () {
    chatBox.style.display = 'block';
}
minimizeIcon.onclick = function () {
    chatBox.style.display = 'none';
}